<div class="contenedor-carreras">
  <h2>üìã Carreras Guardadas</h2>

  @if (cargando) {
  <div class="loading">
    <div class="spinner"></div>
    Cargando carreras...
  </div>
  }

  @if (!cargando && carrerasGuardadas.length === 0) {
  <div class="sin-carreras">
    <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
      <path
        d="M9 12H15M9 16H15M17 21H7C5.89543 21 5 20.1046 5 19V5C5 3.89543 5.89543 3 7 3H12.5858C12.851 3 13.1054 3.10536 13.2929 3.29289L18.7071 8.70711C18.8946 8.89464 19 9.149 19 9.41421V19C19 20.1046 18.1046 21 17 21Z"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    <p>No hay carreras registradas.</p>
  </div>
  }

  @if (!cargando && carrerasGuardadas.length > 0) {
  <div class="lista-carreras">
    @for (carrera of carrerasGuardadas; track carrera.nombre) {
    <div class="carrera-card" (click)="abrirModal(carrera)">
      <div class="carrera-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M12 14L21 9L12 4L3 9L12 14Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M12 14L21 9V15C21 15 19 17 12 17C5 17 3 15 3 15V9L12 14Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="carrera-info">
        <h3>{{ carrera.nombre }}</h3>
        <p>Click para ver detalles</p>
      </div>

      <div class="carrera-arrow">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path
            d="M9 18L15 12L9 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
    </div>
    }
  </div>
  }
</div>

@if (modalAbierto) {
<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üìù Registrar Docente</h2>
      <button class="btn-cerrar" (click)="cerrarModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M18 6L6 18M6 6L18 18"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="carrera-seleccionada">
        <strong>Carrera:</strong> {{ carreraSeleccionada?.nombre }}
      </div>

      <div class="toggle-formulario">
        <button type="button" class="btn-toggle" (click)="toggleFormularioDocente()">
          {{ mostrarFormularioDocente ? '‚ûñ Ocultar Formulario' : '‚ûï Agregar Docente' }}
        </button>
      </div>

      @if (mostrarFormularioDocente) {
      <form class="formulario-docente" (ngSubmit)="guardarDocente()">
        <div class="form-group">
          <label for="nombreCompleto">Nombre Completo del Docente</label>
          <input type="text" id="nombreCompleto" [(ngModel)]="nombreCompleto" name="nombreCompleto"
            placeholder="Ej. Juan P√©rez Garc√≠a" required />
        </div>

        <div class="form-group">
          <label for="cedula">C√©dula</label>
          <input type="text" id="cedula" [(ngModel)]="cedula" name="cedula" placeholder="Ej. 0102030405" required />
        </div>

        <div class="form-group">
          <label for="formacion">Formaci√≥n</label>
          <input type="text" id="formacion" [(ngModel)]="formacion" name="formacion"
            placeholder="Ej. Ingenier√≠a, Licenciatura" required />
        </div>

        <div class="form-group">
          <label for="programa">Programa</label>
          <input type="text" id="programa" [(ngModel)]="programa" name="programa"
            placeholder="Ej. Maestr√≠a en Educaci√≥n, Doctorado" required />
        </div>

        <div class="form-group">
          <label for="estado">Estado</label>
          <select id="estado" [(ngModel)]="estado" name="estado" required>
            <option value="" disabled selected>Seleccione estado</option>
            <option value="Cursando">Cursando</option>
            <option value="Finalizado">Finalizado</option>
          </select>
        </div>

        <div class="form-group">
          <label for="periodo">Periodo</label>
          <input type="text" id="periodo" [(ngModel)]="periodo" name="periodo" placeholder="Ej. 2022-2024, 2021-I"
            required />
        </div>

        <div class="modal-buttons">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">
            Cancelar
          </button>
          <button type="submit" class="btn-guardar">
            Guardar Docente
          </button>
        </div>
      </form>
      }

      <div class="lista-docentes">
        <h3>üë®‚Äçüè´ Docentes Registrados</h3>

        @if (cargando) {
        <p>Cargando docentes...</p>
        }

        @if (!cargando && docentes.length === 0) {
        <p>No hay docentes registrados a√∫n.</p>
        }

        @for (docente of docentes; track docente.id) {
        <div class="docente-card-tabla">
          <div class="docente-nombre">
            <strong>{{ docente.nombre }}</strong>
            <span class="docente-formacion"> | Formaci√≥n: {{ docente.formacion }}</span>
          </div>

          <div class="docente-capacitaciones">
            <p><em>Capacitaciones asignadas:</em></p>
            @for (cap of capacitaciones; track cap.nombre) {
            <div class="capacitacion-mini">
              ‚Ä¢ {{ cap.nombre }} ({{ cap.horas }} horas)
            </div>
            }
          </div>

          <div class="docente-acciones">
            <button class="btn-tabla" type="button" (click)="abrirModalPatrocinio(docente)">patrocinio</button>
            <button class="btn-tabla btn-editar-tabla" type="button" (click)="editarDocente(docente)">editar</button>
            <button class="btn-tabla btn-eliminar-tabla" (click)="eliminarDocente(docente.id!)">eliminar</button>
          </div>
        </div>
        }
      </div>

    </div>
  </div>
</div>
}

@if (modalPatrocinioAbierto) {
<div class="modal-overlay" (click)="cerrarModalPatrocinio()">
  <div class="modal-container-patrocinio" (click)="$event.stopPropagation()">
    
    @if (generandoDocumento) {
    <div class="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
      </div>
      <p class="loading-text">Generando documento...</p>
    </div>
    }
    
    <div class="modal-header">
      <h2>üìÑ Generar Patrocinio</h2>
      <button class="btn-cerrar" (click)="cerrarModalPatrocinio()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    </div>

    <div class="modal-body-patrocinio">
      <div class="info-docente">
        <strong>üë§ Docente:</strong> {{ docenteSeleccionado?.nombre }}
      </div>

      <div class="form-group">
        <label for="capacitacion">Seleccione Capacitaci√≥n:</label>
        <select id="capacitacion" [(ngModel)]="capacitacionSeleccionada" required>
          <option [ngValue]="null">-- Seleccione una capacitaci√≥n --</option>
          @for (cap of capacitaciones; track cap.nombre) {
          <option [ngValue]="cap">{{ cap.nombre }}</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="plantilla">Seleccione Plantilla:</label>
        <select id="plantilla" [(ngModel)]="plantillaSeleccionada" required>
          <option [ngValue]="null">-- Seleccione una plantilla --</option>
          @for (doc of plantillasDisponibles; track doc.fileId) {
          <option [ngValue]="doc">{{ doc.nombre }}</option>
          }
        </select>
      </div>

      <div class="codigo-generacion">
        <h4>üî¢ C√≥digo de Patrocinio</h4>
        <div class="codigo-preview">
          {{ codigoGenerado }}
        </div>
        
        <div class="codigo-inputs">
          <div class="form-group-inline">
            <label for="anio">A√±o:</label>
            <input type="number" id="anio" [(ngModel)]="anio" (ngModelChange)="generarCodigo()" placeholder="2025" min="2000" max="2100" required />
          </div>
          
          <div class="form-group-inline">
            <label for="mes">Mes:</label>
            <input type="number" id="mes" [(ngModel)]="mes" (ngModelChange)="generarCodigo()" placeholder="01" min="1" max="12" required />
          </div>
        </div>
        
        <div class="info-secuencia">
          <small>‚ÑπÔ∏è Secuencia basada en el total de docentes registrados ({{ todosLosDocentes.length }})</small>
        </div>
      </div>

      <div class="modal-buttons">
        <button type="button" class="btn-cancelar" (click)="cerrarModalPatrocinio()">
          Cancelar
        </button>
        <button type="button" class="btn-generar" (click)="generarPatrocinio()" [disabled]="generandoDocumento">
          üì• Generar Documento
        </button>
      </div>
    </div>
  </div>
</div>
}

<div class="seccion-documentos">
  <div class="barra-expandible" [class.expandida]="seccionDocumentosExpandida">
    <button class="btn-expandir" (click)="toggleSeccionDocumentos()">
      <span class="icono-expandir">
        {{ seccionDocumentosExpandida ? '‚ñº' : '‚ñ∂' }}
      </span>
      <span class="titulo-seccion">üìÅ Gesti√≥n de Plantillas</span>
      <span class="badge-contador">{{ plantillasDisponibles.length }}</span>
    </button>
    
    @if (seccionDocumentosExpandida) {
    <div class="contenido-expandible">
      <app-documentos (documentosActualizados)="onDocumentosActualizados($event)"></app-documentos>
    </div>
    }
  </div>
</div>